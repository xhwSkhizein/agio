# 六、验收标准

## 6.1 功能验收

- [ ] Agent 单独运行正常
- [ ] PipelineWorkflow 运行正常
- [ ] ParallelWorkflow 运行正常
- [ ] LoopWorkflow 运行正常
- [ ] 嵌套 Workflow（Workflow 包含 Workflow）
- [ ] 混合嵌套（Workflow 包含 Agent 和 Workflow）
- [ ] Resume 场景正常
- [ ] Fork+Resume 场景正常
- [ ] Workflow 内的 Agent 执行有独立 Run 记录（无重复）
- [ ] Run 记录包含正确的 `parent_run_id` 层级关系
- [ ] Fork 基于 Step sequence 统一工作（Agent 和 Workflow 共用）
- [ ] Resume 后 WorkflowState 正确从 Steps 重建节点状态
- [ ] `list_runs()` 支持 `top_level_only` 过滤
- [ ] 所有现有测试通过

## 6.2 架构验收

- [ ] `Runnable`, `RunOutput` 位于 `domain/protocol.py`
- [ ] `RunMetrics` 统一位于 `domain/models.py`（删除 `AgentRunMetrics`）
- [ ] 不存在 `agio/core/` 目录
- [ ] `WorkflowState`, `ContextResolver` 位于 `workflow/` 目录
- [ ] `RunnableExecutor` 位于 `runtime/runnable_executor.py`
- [ ] `Runnable.run()` 签名**保持不变**
- [ ] Agent 和 Workflow **各自管理自己的状态**（Steps vs WorkflowState）
- [ ] 只有一个 `Run` 模型，通过 `runnable_type` 区分
- [ ] `runtime/` 目录不再包含 Workflow 专用组件（WorkflowState, ContextResolver）
- [ ] Workflow 通过构造函数注入 SessionStore
- [ ] Fork/Resume 统一基于 Step 粒度，无需区分 Agent/Workflow
- [ ] `WorkflowState` 按 `workflow_id + session_id` 查询，而非 `run_id`
- [ ] `Run` 模型完全替代 `AgentRun`，无向后兼容代码
- [ ] `RunOutput.metrics` 正确传递到 `Run.metrics`
- [ ] Workflow metrics 正确聚合子 Runnable 的 metrics
- [ ] 事件发射职责清晰：RunnableExecutor(Run) / Workflow(Node) / StepRunner(Step)

## 6.3 代码质量验收

- [ ] 无循环依赖
- [ ] import 路径清晰
- [ ] 类型注解完整
- [ ] 日志输出正常
- [ ] RunnableExecutor 代码行数 < 150 行
- [ ] 无 `AgentRunMetrics` 遗留引用
- [ ] 无 `workflow/protocol.py` 中的 `RunMetrics` 遗留引用
- [ ] `StepRunner` 不创建 Run 记录
- [ ] `StepRunner` 不发射 `run_started` / `run_completed` 事件
- [ ] `StepRunner` 使用 `context.run_id`，不再自己生成 run_id
- [ ] `BaseWorkflow` 构造函数接受 `session_store` 参数
- [ ] Metrics 体系为 3 层（StepMetrics, RunMetrics, SessionMetrics），无 `LLMCallMetrics`
- [ ] 无 `runtime/__init__.py` 中对 `WorkflowState`/`ContextResolver` 的重导出
- [ ] 无 `AgentRun` 遗留引用
- [ ] 无 `agent_id` 遗留字段（统一使用 `runnable_id`）
- [ ] `WorkflowState` 不再依赖 `run_id` 参数
