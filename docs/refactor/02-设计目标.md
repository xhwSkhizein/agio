# 二、重构目标

## 2.1 核心原则

1. **统一执行层抽象**：Agent 和 Workflow 都应有 Runner 层管理生命周期
2. **统一依赖注入**：SessionStore 通过构造函数注入，而非 metadata
3. **清晰的模块边界**：Workflow 专用组件归入 `workflow/` 目录
4. **统一 Run 元数据**：Workflow 也创建 Run 记录，支持执行追踪

## 2.2 目标架构

```
┌─────────────────────────────────────────────────────────────┐
│                      API Layer                               │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────────────────┐    ┌──────────────────────────┐   │
│  │      Agent           │    │       Workflow           │   │
│  │  (Config Container)  │    │   (Config Container)     │   │
│  └──────────┬───────────┘    └────────────┬─────────────┘   │
│             │                             │                  │
│             ▼                             ▼                  │
│  ┌──────────────────────┐    ┌──────────────────────────┐   │
│  │     StepRunner       │    │    WorkflowRunner        │   │
│  │  (Lifecycle Mgmt)    │    │   (Lifecycle Mgmt)       │   │
│  └──────────┬───────────┘    └────────────┬─────────────┘   │
│             │                             │                  │
│             ▼                             ▼                  │
│  ┌──────────────────────┐    ┌──────────────────────────┐   │
│  │    StepExecutor      │    │  WorkflowState/Resolver  │   │
│  │   (LLM Loop)         │    │   (State Management)     │   │
│  └──────────────────────┘    └──────────────────────────┘   │
│                                                              │
├─────────────────────────────────────────────────────────────┤
│                     SessionStore                             │
│              (Unified Persistence Layer)                     │
└─────────────────────────────────────────────────────────────┘
```

## 2.3 预期收益

1. **一致性**：统一的执行模型，降低理解成本
2. **可追踪性**：Workflow 执行历史可查询
3. **可维护性**：清晰的模块边界，易于扩展
4. **健壮性**：统一的 Resume 机制，更可靠的错误恢复
